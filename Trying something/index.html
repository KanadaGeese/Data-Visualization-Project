<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NBA Player Journey Map</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 2rem;
      font-weight: 500;
      color: #222;
    }

    #controls {
      margin: 1rem 0;
    }

    input[type="text"] {
      padding: 10px 16px;
      font-size: 16px;
      width: 300px;
      border: 1px solid #ccc;
      border-radius: 12px;
      outline: none;
    }

    button {
      margin-left: 10px;
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      border-radius: 12px;
      background-color: #0059ff;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #003ecf;
    }

    #sliderWrapper {
      margin-top: 20px;
    }

    .slider-labels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .slider-label {
      padding: 6px 10px;
      border-radius: 8px;
      background: #f0f0f0;
      cursor: pointer;
    }

    .slider-label:hover {
      background: #0059ff;
      color: white;
    }

    #map {
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }

    .country {
      fill: #f2f2f2;
      stroke: #ddd;
      stroke-width: 0.5;
    }

    .state-outline {
      fill: none;
      stroke: #bbb;
      stroke-width: 0.5;
    }

    .team-logo {
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>NBA Player Journey Map</h1>

  <div id="controls">
    <input id="playerInput" type="text" placeholder="Enter Player Name" />
    <button onclick="startJourney()">Start</button>
    <button onclick="showAllTeams()">Show All Teams</button>
  </div>

  <div id="sliderWrapper" style="display:none;">
    <div id="sliderLabels" class="slider-labels"></div>
  </div>

  <svg id="map" width="960" height="600"></svg>

  <script>
    const teamCoords = {
      ATL: { city: "Atlanta", lat: 33.755, lon: -84.390 },
      BOS: { city: "Boston", lat: 42.3601, lon: -71.0589 },
      BRK: { city: "Brooklyn", lat: 40.6782, lon: -73.9442 },
      CHA: { city: "Charlotte", lat: 35.2271, lon: -80.8431 },
      CHI: { city: "Chicago", lat: 41.8781, lon: -87.6298 },
      CLE: { city: "Cleveland", lat: 41.4993, lon: -81.6944 },
      DAL: { city: "Dallas", lat: 32.7767, lon: -96.7970 },
      DEN: { city: "Denver", lat: 39.7392, lon: -104.9903 },
      DET: { city: "Detroit", lat: 42.3314, lon: -83.0458 },
      GSW: { city: "San Francisco", lat: 37.7749, lon: -122.4194 },
      HOU: { city: "Houston", lat: 29.7604, lon: -95.3698 },
      IND: { city: "Indianapolis", lat: 39.7684, lon: -86.1581 },
      LAC: { city: "Los Angeles", lat: 34.0522, lon: -118.2437 },
      LAL: { city: "Los Angeles", lat: 34.0522, lon: -118.2437 },
      MEM: { city: "Memphis", lat: 35.1495, lon: -90.0490 },
      MIA: { city: "Miami", lat: 25.7617, lon: -80.1918 },
      MIL: { city: "Milwaukee", lat: 43.0389, lon: -87.9065 },
      MIN: { city: "Minneapolis", lat: 44.9795, lon: -93.2760 },
      NOP: { city: "New Orleans", lat: 29.9511, lon: -90.0715 },
      NOH: { city: "New Orleans", lat: 29.9511, lon: -90.0715 },
      NJN: { city: "Newark", lat: 40.7357, lon: -74.1724 },
      NYK: { city: "New York", lat: 40.7128, lon: -74.0060 },
      OKC: { city: "Oklahoma City", lat: 35.4676, lon: -97.5164 },
      ORL: { city: "Orlando", lat: 28.5383, lon: -81.3792 },
      PHI: { city: "Philadelphia", lat: 39.9526, lon: -75.1652 },
      PHO: { city: "Phoenix", lat: 33.4484, lon: -112.0740 },
      POR: { city: "Portland", lat: 45.5051, lon: -122.6750 },
      SAC: { city: "Sacramento", lat: 38.5816, lon: -121.4944 },
      SAS: { city: "San Antonio", lat: 29.4241, lon: -98.4936 },
      SEA: { city: "Seattle", lat: 47.6062, lon: -122.3321 },
      TOR: { city: "Toronto", lat: 43.6532, lon: -79.3832 },
      UTA: { city: "Salt Lake City", lat: 40.7608, lon: -111.8910 },
      VAN: { city: "Vancouver", lat: 49.2827, lon: -123.1207 },
      WAS: { city: "Washington", lat: 38.9072, lon: -77.0369 },
      CHH: { city: "Charlotte", lat: 35.2271, lon: -80.8431 }
    };

    const svg = d3.select("#map");
    const width = +svg.attr("width");
    const height = +svg.attr("height");
    const projection = d3.geoMercator().center([-95, 40]).scale(600).translate([width / 2, height / 2]);
    const path = d3.geoPath().projection(projection);

    let fullData = [];
    let playerSeasons = [];

    Promise.all([
      d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
      d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json"),
      d3.csv("nba_player_stats_C_Rami.csv")
    ]).then(([world, usTopo, data]) => {
      fullData = data;

      svg.append("g")
        .selectAll("path")
        .data(world.features)
        .enter()
        .append("path")
        .attr("class", "country")
        .attr("d", path);

      const states = topojson.feature(usTopo, usTopo.objects.states).features;
      svg.append("g")
        .selectAll("path")
        .data(states)
        .enter()
        .append("path")
        .attr("class", "state-outline")
        .attr("d", path);
    });

    function startJourney() {
      const name = document.getElementById("playerInput").value.trim().toLowerCase();
      const seasons = fullData
        .filter(d => d.Player.toLowerCase() === name)
        .map(d => ({ season: d.Season, team: d.Team }))
        .sort((a, b) => +a.season - +b.season);

      if (seasons.length === 0) return alert("Player not found.");

      playerSeasons = seasons;
      document.getElementById("sliderWrapper").style.display = "block";
      const labelContainer = document.getElementById("sliderLabels");
      labelContainer.innerHTML = "";
      svg.selectAll(".team-logo, .team-logo-temp").remove();

      seasons.forEach((s, i) => {
        const label = document.createElement("span");
        label.className = "slider-label";
        label.innerText = s.season;
        label.onmouseenter = () => showLogoTemp(i);
        label.onclick = () => lockLogo(i);
        labelContainer.appendChild(label);
      });

      showLogoTemp(0);
    }

    function showLogoTemp(index) {
      const { team } = playerSeasons[index];
      const coords = teamCoords[team];
      svg.selectAll(".team-logo-temp").remove();
      if (!coords) return;

      const [x, y] = projection([coords.lon, coords.lat]);
      svg.append("image")
        .attr("xlink:href", `logos/${team}.png`)
        .attr("x", x - 25)
        .attr("y", y - 25)
        .attr("width", 50)
        .attr("height", 50)
        .attr("class", "team-logo team-logo-temp");
    }

    function lockLogo(index) {
      const { team } = playerSeasons[index];
      const coords = teamCoords[team];
      if (!coords) return;
      const [x, y] = projection([coords.lon, coords.lat]);

      svg.append("image")
        .attr("xlink:href", `logos/${team}.png`)
        .attr("x", x - 25)
        .attr("y", y - 25)
        .attr("width", 50)
        .attr("height", 50)
        .attr("class", "team-logo");
    }

    function showAllTeams() {
      svg.selectAll(".team-logo-temp, .team-logo").remove();
      const seen = new Set();

      playerSeasons.forEach(({ team }) => {
        if (seen.has(team)) return;
        seen.add(team);
        const coords = teamCoords[team];
        if (!coords) return;
        const [x, y] = projection([coords.lon, coords.lat]);

        svg.append("image")
          .attr("xlink:href", `logos/${team}.png`)
          .attr("x", x - 25)
          .attr("y", y - 25)
          .attr("width", 50)
          .attr("height", 50)
          .attr("class", "team-logo");
      });
    }
    function animateCareer(playerSeasons) {
  let index = 0;

  function step() {
    if (index >= playerSeasons.length) return;

    const season = playerSeasons[index];
    const coords = teamCoords[season.team];

    if (coords) {
      const [x, y] = projection([coords.lon, coords.lat]);

      svg.selectAll(".team-logo")
        .data([season])
        .join(
          enter => enter.append("image")
            .attr("class", "team-logo")
            .attr("xlink:href", `logos/${season.team}.png`)
            .attr("x", x - 25)
            .attr("y", y - 25)
            .attr("width", 50)
            .attr("height", 50)
            .style("opacity", 0)
            .transition()
            .duration(1000)
            .style("opacity", 1),
          update => update
            .transition()
            .duration(1000)
            .attr("x", x - 25)
            .attr("y", y - 25)
        );
    }

    index++;
    setTimeout(step, 1500); // Wait 1.5 seconds before the next step
  }

  step();
}

  </script>
</body>
</html>
